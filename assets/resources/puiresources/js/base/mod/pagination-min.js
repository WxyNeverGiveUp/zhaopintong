KISSY.add("mod/pagination",function(b,a){PW.pagination=function(c){return new a(c);};},{requires:["mod/pagination/core"]});KISSY.add("mod/pagination/core",function(h,o,g,k,b){var r=h.DOM,f=r.get,n=r.query,p=h.JSON,m=h.Event.on,c=h.IO,s=function(){},l={showCounter:true,themeCounter:"{page}/{pageCount}",showJump:true,themeJump:"跳到第{input}页{button}",showPageNum:true,showFirst:false,showLast:false,themeCss:"J_pagination_theme1",firstPageTip:"<<",lastPageTip:">>",prevPageTip:"上一页",nextPageTip:"下一页"},e={renderTo:"",juicerRender:"",dataRender:"#J_template",page:1,pageSize:10000,dataCount:0,pageCount:0,themePackageURL:"",themeName:"default",type:"get",url:"",extraParam:null,sendData:function(){},configUrl:function(j,t,a){},beforeDataLoad:s,afterDataLoad:s,initCompleted:s,beforeSendAJAX:s,errorFun:s};THEME_URL=PW.libUrl+"js/base/assets/pagination/css/default.css";h.getScript(THEME_URL,{charset:"utf-8"});var q=function(j){var a=h.clone(e);this.opts=h.mix(a,j,true,[],true);this.lock=false;this.init();};q.prototype={init:function(){var j=this,a=j.opts;j.prevPaginationData=null;j._getThemePackage();if(a.initCompleted){a.initCompleted();}},reload:function(a){this.opts=h.mix(this.opts,a);this.tDOM.html("");this.init();},refresh:function(t){this.opts=h.mix(this.opts,t);var a=Math.ceil(this.opts.dataCount/this.opts.pageSize);var j=this;if(a!=this.opts.pageCount){j._sendAjax(this.opts.page);}},_getThemePackage:function(){var t=this,j=t.opts,a=j.themePackageURL,v;if(a&&a!==""&&a!==null&&a!==undefined){v=$.getJSON(a,function(x){x=(h.isString(x))?h.JSON.parse(x):x;var w;if(j.themeName){w=j.themeName;}else{w="default";}t.opts.themePackage=x.pagination[w];});window.setTimeout(function(){if(v.status!==200){h.log("主题包获取失败,直接使用默认配置！");if(j.themePackage){var w;if(j.themeName){w=j.themeName;}else{w="default";}if(PW.modSettings.pagination){t.opts.themePackage=PW.modSettings.pagination.themePackage[w];}}else{j.themePackage=l;}}},2000);t.prevPaginationData;t.pctrl=new b(j);t._sendAjax(j.page);}else{if(PW.modSettings){if(PW.modSettings.pagination){var u;if(j.themeName){u=j.themeName;}else{u="default";}t.opts.themePackage=PW.modSettings.pagination.themePackage[u];}else{j.themePackage=l;}}t.prevPaginationData;t.pctrl=new b(j);t._sendAjax(j.page);}},_sendAjax:function(u){var t=this,j=t.opts,a;if(!j.timeout||j.timeout==undefined||j.timeout==""||j.timeout==null){j.timeout=10;}t.lock=true;c({type:j.type,url:j.configUrl(t.opts.url,t.opts.page,t,t.prevPaginationData),data:h.mix({_:h.now()},j.extraParam),timeout:j.timeout,success:function(B){B=(h.isString(B))?h.JSON.parse(B):B;if(j.beforeDataLoad){if(j.beforeDataLoad(t,B)==false){t.lock=false;return;}}if(B.dataCount!==null&&B.dataCount!==""&&B.dataCount!==undefined){j.dataCount=B.dataCount;}j.pageCount=Math.ceil(j.dataCount/j.pageSize);t.opts.sendData(t,B);for(i in B){if(h.isArray(B[i])){var A=B[i];}}if(A){if(A.length==0){var x=r.get(j.dataRender).nodeName.toLowerCase();if(x=="tbody"){$(j.dataRender).parent().attr("id","J_dataRenderTab");var z=document.getElementById("J_dataRenderTab"),w=z.rows[0].cells.length,y='<tr><td colspan="'+w+'" align="center">暂无数据！</td></tr>';$(j.dataRender).html(y);}else{r.html(j.dataRender,"暂无数据！");}}else{var v=document.getElementById(j.juicerRender).innerHTML;t.prevPaginationData=B;var y=g(v,B);r.html(j.dataRender,y);r.html(j.renderTo,"");t.pctrl.refresh(j.dataCount,u);}}t._pageClick();if(j.afterDataLoad){j.afterDataLoad(t,B,u);}t.lock=false;},error:function(){h.log("ajax发送失败，没有获取到数据！");if(j.errorFun){j.errorFun(t);}}});},_pageClick:function(){var j=this,a=j.opts;j.tDOM=$(a.renderTo);j.tDOM.find("#J_firstPage").click(function(){if(!($(this).hasClass("disabled"))){if(!j.lock){a.page=1;j._sendAjax(a.page);}}});j.tDOM.find("#J_prevPage").click(function(){if(!($(this).hasClass("disabled"))){if(!j.lock){a.page=a.page-1;j._sendAjax(a.page);}}});j.tDOM.find("#J_nextPage").click(function(){if(!($(this).hasClass("disabled"))){if(!j.lock){a.page=a.page+1;j._sendAjax(a.page);}}});j.tDOM.find("#J_lastPage").click(function(){if(!($(this).hasClass("disabled"))){if(!j.lock){a.page=a.pageCount;j._sendAjax(a.page);}}});j.tDOM.find(".J_page").each(function(){if(!($(this).hasClass("check"))){$(this).click(function(){if(!j.lock){var t=$(this).children("span").text();a.page=parseInt(t);j._sendAjax(a.page);}});}});j.tDOM.find(".J_btnGo").click(function(){if($(this).prev("#pageNum").val()&&$(this).prev("#pageNum").val()!==""&&$(this).prev("#pageNum").val()!==null){if(!j.lock){var t=$(this).prev("#pageNum").val();t=parseInt(t);if(t>j.opts.pageCount){a.page=a.pageCount;}else{if(t<1){a.page=1;}else{if(isNaN(t)){a.page=1;}else{a.page=t;}}}j._sendAjax(a.page);}}});},_toPage:function(a){a=parseInt(a);this.opts.page=a;this.tDOM.html("");this.pctrl.refresh(this.opts.dataCount,this.opts.page);}};return q;},{requires:["thirdparty/jquery","mod/juicer","core","pagination/Pctrl"]});KISSY.add("pagination/Pctrl",function(e){var k=e.DOM,b=k.get,h=k.query,j=e.JSON,f=e.Event.on,g=e.io,c={renderTo:"",pageSize:10,showCounter:true,showJump:true,showPageNum:true};function a(l){this.opts=e.mix(c,l,true,[],true);this.page=1;}e.augment(a,e.EventTarget);e.augment(a,{_init:function(){},refresh:function(p,o){var n=this,m=n.opts;m.dataCount=p;m.pageCount=Math.ceil(m.dataCount/m.pageSize);n._checkPage(o);var l=n._generateHTML(o);var q=$(this.opts.renderTo).append(l);$(this.opts.renderTo).addClass(m.themePackage.themeCss);n._addEvt(q);},_addEvt:function(l){this._checkPage();d=k.create(l);return d;},_configHandel:function(){var m=this,l=m.opts;if(l.themePackage){m.themeCounter=l.themePackage.themeCounter;m.themeCounter=e.substitute(m.themeCounter,{page:l.page,pageCount:l.pageCount});m.themeJump=l.themePackage.themeJump;m.themeJump=e.substitute(m.themeJump,{input:'<input type="text" id="pageNum" name="pageNum" class="goTo" value="" />',button:'<button class="J_btnGo" type="button">&nbsp;</button>'});}},_generateHTML:function(s){var r=this,q="",p=this.opts,m=0;p.page=s;var n=parseInt(p.page)-1,l=parseInt(p.page)+1;r._configHandel();if(n<1){if(p.themePackage.showFirst==true){q+='<span id="J_firstPage" class="firstPage disabled" title="First Page">'+p.themePackage.firstPageTip+"</span>";}q+='<span id="J_prevPage" class="prevPage disabled" title="Prev Page">'+p.themePackage.prevPageTip+"&nbsp;</span>";}else{if(p.themePackage.showFirst==true){q+='<a><span id="J_firstPage" title="First Page">'+p.themePackage.firstPageTip+"</span></a>";}q+='<a><span id="J_prevPage" title="Prev Page">'+p.themePackage.prevPageTip+"&nbsp;</span></a>";}if(p.page!=1&&p.themePackage.showPageNum==true){q+='<a class="J_page"><span title="Page 1">1</span></a>';}if(p.page>=5&&p.themePackage.showPageNum==true){q+='<span class="until">...</span>';}if(p.pageCount>p.page+2){m=p.page+2;}else{m=p.pageCount;}for(var o=p.page-2;o<=m;o++){if(o>0){if(o==p.page&&p.themePackage.showPageNum==true){q+='<span title="Page '+o+'" class="check">'+o+"</span>";}else{if(o!=1&&o!=p.pageCount&&p.themePackage.showPageNum==true){q+='<a class="J_page"><span title="Page '+o+'">'+o+"</span></a>";}}}}if(p.page+3<p.pageCount&&p.themePackage.showPageNum==true){q+='<span class="until">...</span>';}if(p.page!=p.pageCount&&p.themePackage.showPageNum==true){q+='<a class="J_page"><span title="Page '+this.opts.pageCount+'">'+this.opts.pageCount+"</span></a>";}if(l>p.pageCount){q+='<span id="J_nextPage" class="nextPage disabled" title="Next Page">&nbsp;'+p.themePackage.nextPageTip+"</span>";if(p.themePackage.showLast==true){q+='<span id="J_lastPage" class="lastPage disabled" title="Last Page">'+p.themePackage.lastPageTip+"</span>";}}else{q+='<a><span id="J_nextPage" title="Next Page">&nbsp;'+p.themePackage.nextPageTip+"</span></a>";if(p.themePackage.showLast==true){q+='<a><span id="J_lastPage" title="Last Page">'+p.themePackage.lastPageTip+"</span></a>";}}if(p.themePackage.showCounter==true&&p.pageCount>=5){q+='<span class="count">'+this.themeCounter+"</span>";}if(p.themePackage.showJump==true&&p.pageCount>=5){q+=this.themeJump;}q+="<br/>";if(p.pageCount<=1){q="";}return q;},_checkPage:function(){var l=this.opts;if(isNaN(parseInt(l.page))){l.page=1;}if(isNaN(parseInt(l.pageCount))){l.pageCount=1;}if(l.page<1){l.page=1;}if(l.pageCount<1){l.pageCount=1;}if(l.page>l.pageCount){l.page=l.pageCount;}l.page=parseInt(l.page);l.pageCount=parseInt(l.pageCount);}});return a;},{requires:["core","thirdparty/jquery"]});